\documentclass{article}

%\include{macros}

\bibliographystyle{plain}

\usepackage{epsfig}
\usepackage{xcolor}
%%\usepackage{amssymb}
\usepackage{amsmath}

\input{abbrev.tex}

\begin{document}

\title{Elliptic operator stability and small cells on  finite volume grids}
\author{
   \and D. Devendran    \footnotemark[2]
   \and D. T. Graves    \footnotemark[1]
        }

\maketitle

\begin{abstract}

Devendran, et al. \cite{Devendran2017} present an algorithm that
solves Poisson's equation to fourth-order accuracy using an EB grid.
Generalizing somewhat  the framework they present, we can define a
family of elliptic operators.
Here we investigate how the accuracy and stability of this family
of operators varies within its parameter space.

\end{abstract}


\section{Underlying mathematics}

Embedded boundary (EB) grids are formed when one passes an  surface
through a Cartesian mesh.    For sufficiently complex geomtries, these methods
are very attactive because grid generation is a solved problem
even for moving grids \cite{MillerTrebotich2012}.
In the current context, we form the cutting surface as the zero
surface of a function  of space $I(\xbold)$, $\xbold \in R^D$.
For smooth ($I$),  moments can be generated to any
accuracy \cite{Schwartz2015}.

Formally, the underlying description of space
is given by rectangular control volumes on a Cartesian mesh
$\Upsilon_\ibold = [(\ibold-\half {\ubold})h, (\ibold+\half
{\ubold})h], \ibold \in \bigzbold^D$, where $D$ is the dimensionality
of the problem, $h$ is the mesh spacing, and ${\ubold}$ is the vector
whose entries are all one (note we use bold font $\ubold = (u_1, \dots, u_d,
\dots, u_D)$ to indicate a vector quantity).
Given an irregular domain $\Omega$, we
obtain control volumes $V_\ibold = \Upsilon_\ibold \bigcap \Omega$ and
faces $A_{\ibold,d\pm} = A_{\ibold \pm \half \ebold_d}$ which are the
intersection of the boundary of $\partial V_\ibold$ with the
coordinate planes $\{{\xbold}:x_d = (i_d \pm \half)h \}$ ($\ebold_d$ is
the unit vector in the $d$ direction).  We also
define $A_{B,\ibold}$ to be the intersection of the boundary of the
irregular domain with the Cartesian control volume: $A_{B,\ibold}
= \partial \Omega \bigcap \Upsilon_\ibold$. 

We use the compact notation
\begin{align*}
(\xbold - \xbar)^\pbold &= \prod\limits^D_{d=1} (x_d - {\bar x}_d)^{p_d} \\
\pbold! &= \prod\limits^D_{d = 1} p_d!
\end{align*}
Given a $D$-dimensional region of space $\ibold$, 
and a $D$-dimensional integer vector
$\pbold$, we define $m_\ibold^\pbold(\xbar)$ to be the $\pbold^{th}$
moment of $\ibold$ to the point $\xbar$.
\begin{equation}
m_\ibold^\pbold(\xbar)  =  \int\limits_{\ibold} (\xbold - \xbar)^\pbold dV^D.
\label{eqn::volmoment}
\end{equation}
This breaks out into three different cases, volumes, coordinate faces
and irregular faces.
A coordinate face $f_{12}$  is the area where two
volumes ($V_1, V_2$) intersect.
A irregular face $f_V$  is area where the cutting surface
intersects the volume $V$.
The volume moment for a particular power $\pbold$  is
given by
\begin{equation}
  m^\pbold_V = \int\limits_{\ibold} (\xbold - \xbar)^\pbold dV
  \label{eqn::volmom}
\end{equation}
The $\pbold^{th}$ coordinate face moment for the area of where volumes $V_1, V2$
intersect is given by
\begin{equation}
  m^\pbold_{f_{12}} = \int\limits_{A(V_1\bigcap V_2)} (\xbold - \xbar)^\pbold dA.
  \label{eqn::facmom}
\end{equation}
The cutting surface of the boundary $G$ is given by  the zero
surface of the  implicit function ($I(\xbold)= 0$) used in grid generation.
The $\pbold^{th}$ irregular face moment is given by an integral over
the intersection of this cutting surface and the Euclidean volume:
\begin{equation}
  m^\pbold_V = \int\limits_{A(V \bigcap G)} (\xbold - \xbar)^\pbold dA.
  \label{eqn::irrmom}
\end{equation}
These moments are the natural product of the grid generation algorithm
in \cite{Schwartz2015}.


\section{Family of finite volume elliptic operators}

Devendran, et al. \cite{Devendran2017} present an algorithm that
solves Poisson's equation to fourth-order accuracy using embedded
boundaries.  Generalizing somewhat  the framework they present, we
present a family of elliptic operators.

We are solving Poisson's equation for field $\psi$, given charge $\rho$:
\begin{equation}
  \nabla \cdot (\nabla \psi) = \rho
  \label{eqn::poisson}
\end{equation}
If we integrate equation \ref{eqn::poisson} and apply the divergence theorem 
over control volumes we get
\begin{equation}
\int_{V_\ibold} \nabla \cdot (\nabla \phi ) dV = \int_{\partial
  V_\ibold} \nabla \phi\cdot \nhat  dA = \int_{V_\ibold} \rho dV
\end{equation}
Without approximation, we can say that the surface integral can be
computed by a sum over the faces that comprise the surface of the
volume.
\begin{equation}
\sum_{f: f \in \partial V_\ibold} \nabla \phi \cdot \nhat dA = \int_{V_\ibold} \rho dV
\end{equation}
Using equations \ref{eqn::faceavg} and \ref{eqn::volavg}, this becomes 
\begin{equation}
\sum_{f: f \in \partial V_\ibold} \avg{\nabla \phi \cdot \nhat}_f A_f
= \avg{\rho}_\ibold V_\ibold
\label{eqn::discretePoisson}
\end{equation}
A finite volume operator is defined by the algorithm to compute the
integral of fluxes at each face.  We have three types of face, open
faces (the faces between two volumes that are aligned with coordinate
directions), domain faces, and cut faces.  For now, let's say we have
homogeneous Neumann boundary conditions at domain and cut faces
$\nabla \psi \cdot \nhat = 0 |\partial \Omega$.  In this case, to
describe the algorithm, we need only describe how to compute $<\nabla
\psi \cdot \nhat>$ on open faces.

\section{Open face flux computation}
\section{Dirichlet fluxes at boundaries}
We can approximate $\psi$
in the neighborhood of $\xbar$ using a Taylor expansion to order $P_T$:
\begin{equation}
\psi(\xbold)  =  \sum\limits_{p < P_T} C^p (\xbar -\xbar)^p
\label{eqn::taylor}
\end{equation}
where $C^p$ this appropriate Taylor coefficient.  In three dimensions,
\begin{equation}
  C^p =\frac{1}{p!}
      \frac{\partial^{p_0}}{\partial x_0}
      \frac{\partial^{p_1}}{\partial x_1}
      \frac{\partial^{p_2}}{\partial x_2}  (\psi).
\end{equation}
If we know the local Taylor coeffiencts,
the gradient of the field  in direction $d$ is given by
\begin{equation}
  \frac{\partial \psi}{\partial x^d} \psi =
  \sum\limits_{p < P_T} p^d C^{p-e^d} (\xbar -\xbar)^{p-e^d}
\end{equation}

In finite volume  methods, we define grid data to be
averages over volumes and fluxes between volumes are averages over the
faces between volumes.   
For the field $\psi$, the average over the volume $\ibold$ is given by
\begin{equation*}
 V_\ibold <\psi>_\ibold = \int\limits_{V_\ibold} \psi(\xbold) dV
\end{equation*}
If we insert the Taylor expansion \ref{eqn::taylor}, we get a discrete
approximation to the smooth function $\psi$ that is accurate to order $P_T$.
\begin{equation*}
  <\psi>_\ibold = \frac{1}{V_\ibold} \sum\limits_{p < P_T} C^p m^p
  \label{eqn::vol}.
\end{equation*}
Similarly, integrating the flux over a d-directional face $\fbold$:
\begin{equation*}
  <\nabla \psi_d>_\ibold = \frac{1}{A_f\bold}
  \sum\limits_{p < P_T} p^d C^{p-e^d} m^{p-e^d}
  \label{eqn::vol}.
\end{equation*}
To solve for the Taylor coefficients, we use the neighboring volumes's
values  to form a system of equations (equation \eqn::vol
for each volume $\ibold \in N_f$, the neighborhood of $f$).  Boundary
condition equations are also added to the system.   We force there
to be enough neighbors so that this system is overdetermined.

\section{}

\section{Stability and Conditioning}

The matrix $A_{P_T, P_W}$ for a particular polynomial order $P_T$ and
weighting exponent  $P_W$ may be unstable or poorly conditioned.   We
measure both while varying $P_T, P_W$ in both two and three
dimensions.    All these calculations are done using SLEPc and PETc
\cite{petsc-user-ref, petsc-efficient, slepc}.




\section{Conclusions}



\footnotetext[1]{Lawrence Berkeley National Laboratory, Berkeley,
  CA. Research at LBNL was supported financially by the Office of
  Advanced Scientific Computing Research of the US Department of
  Energy under contract number DE-AC02-05CH11231.}
\footnotetext[2]{Ford Motor Company, Sunnyvale, CA.}
\renewcommand{\thefootnote}{\fnsymbol{footnote}}\
\bibliography{references}

\end{document}
